(()=>{var e={};e.id=907,e.ids=[907],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},34256:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>g,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var r=s(50482),a=s(69108),n=s(62563),o=s.n(n),l=s(68300),i={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);s.d(t,i);let d=["",{children:["dashboard",{children:["bookings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,77373)),"/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/bookings/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,96339)),"/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,82917)),"/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/bookings/page.tsx"],u="/dashboard/bookings/page",g={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/bookings/page",pathname:"/dashboard/bookings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},53115:(e,t,s)=>{Promise.resolve().then(s.bind(s,26679))},26679:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var r=s(95344),a=s(3729),n=s(27984),o=s(8428),l=s(64290),i=s(73229),d=s(51838),c=s(28765),u=s(55794),g=s(80508),m=s(53148),x=s(39674),p=s(48067);function b(){let e=(0,o.useRouter)(),t=(0,o.useSearchParams)(),[s,b]=(0,a.useState)([]),[f,h]=(0,a.useState)([]),[y,k]=(0,a.useState)(!0),[v,j]=(0,a.useState)(""),[N,w]=(0,a.useState)("all"),[_,D]=(0,a.useState)(null),[C,E]=(0,a.useState)(null),P=[{value:"all",label:"Alla"},{value:"draft",label:"Utkast"},{value:"pending",label:"V\xe4ntande"},{value:"confirmed",label:"Bekr\xe4ftad"},{value:"completed",label:"Slutf\xf6rd"},{value:"cancelled",label:"Avbruten"}];(0,a.useEffect)(()=>{let e=t.get("status");e&&P.find(t=>t.value===e)&&w(e),S()},[]),(0,a.useEffect)(()=>{let e=s;v&&(e=e.filter(e=>e.booking_number.toLowerCase().includes(v.toLowerCase())||e.customer.name.toLowerCase().includes(v.toLowerCase())||e.location.toLowerCase().includes(v.toLowerCase()))),"all"!==N&&(e=e.filter(e=>e.status===N)),e.sort((e,t)=>{let s={draft:0,pending:1,confirmed:2,completed:3,cancelled:4};return(s[e.status]||5)-(s[t.status]||5)}),h(e)},[v,N,s]);let S=async()=>{try{k(!0);let{data:e,error:t}=await n.O.from("bookings").select("*").order("created_at",{ascending:!1});if(t)throw t;let s=await Promise.all((e||[]).map(async e=>{if(!e.customer_id)return{...e,customer:{name:"Ok\xe4nd",email:""}};let{data:t}=await n.O.from("customers").select("name, email, phone").eq("id",e.customer_id).single();return{...e,customer:t||{name:"Ok\xe4nd",email:""}}}));b(s)}catch(e){console.error("Error fetching bookings:",e)}finally{k(!1)}},q=async e=>{try{D(e),console.log("\uD83D\uDD04 Starting booking confirmation for:",e);let t=Math.random().toString(36).substring(2,15)+Date.now().toString(36);console.log("✅ Generated token:",t),console.log("\uD83D\uDCDD Inserting booking token...");let{error:s}=await n.O.from("booking_tokens").insert([{booking_id:e,token:t}]);if(s)throw console.error("❌ Token error:",s),Error(`Token error: ${s.message}`);console.log("✅ Token created successfully"),console.log("\uD83D\uDD04 Updating booking status to confirmed...");let{error:r}=await n.O.from("bookings").update({status:"confirmed"}).eq("id",e);if(r)throw console.error("❌ Booking update error:",r),Error(`Booking update error: ${r.message}`);console.log("✅ Booking status updated to confirmed"),console.log("\uD83D\uDCCB Checking for existing booking confirmation...");let{data:a}=await n.O.from("booking_confirmations").select("id").eq("booking_id",e).single();if(a){console.log("✅ Booking confirmation already exists - updating email_sent flag...");let{error:t}=await n.O.from("booking_confirmations").update({email_sent:!1}).eq("booking_id",e);t?console.error("⚠️ Update confirmation error:",t):console.log("✅ Booking confirmation updated")}else{console.log("\uD83D\uDCCB Creating booking confirmation...");let{error:t}=await n.O.from("booking_confirmations").insert([{booking_id:e,email_sent:!1}]);t?console.error("⚠️ Confirmation error (non-critical):",t):console.log("✅ Booking confirmation created")}b(t=>t.map(t=>t.id===e?{...t,status:"confirmed"}:t)),E({type:"success",text:"✅ Bokning bekr\xe4ftad! L\xe4nk och bekr\xe4ftelse skickas till kund..."}),setTimeout(()=>E(null),3e3)}catch(t){console.error("❌ Error confirming booking:",t);let e=t instanceof Error?t.message:"Ok\xe4nt fel";E({type:"error",text:`Kunde inte bekr\xe4fta bokning: ${e}`}),setTimeout(()=>E(null),5e3)}finally{D(null)}},Z=async(e,t)=>{try{D(e);let{error:s}=await n.O.from("bookings").update({status:t}).eq("id",e);if(s)throw s;b(s=>s.map(s=>s.id===e?{...s,status:t}:s));let r=O(t);E({type:"success",text:`Status uppdaterad till: ${r}`}),setTimeout(()=>E(null),3e3)}catch(t){console.error("Error updating status:",t);let e=t instanceof Error?t.message:"Ok\xe4nt fel";E({type:"error",text:`Kunde inte uppdatera status: ${e}`}),setTimeout(()=>E(null),3e3)}finally{D(null)}},B=e=>{switch(e){case"draft":return"bg-orange-100 text-orange-700 border-orange-300";case"pending":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"confirmed":return"bg-green-100 text-green-700 border-green-300";case"completed":return"bg-blue-100 text-blue-700 border-blue-300";case"cancelled":return"bg-red-100 text-red-700 border-red-300";default:return"bg-gray-100 text-gray-700 border-gray-300"}},O=e=>{let t=P.find(t=>t.value===e);return t?.label||e},$=s.filter(e=>"draft"===e.status).length,z=s.filter(e=>"pending"===e.status).length;return(0,r.jsxs)("div",{className:"space-y-6",children:[C&&(0,r.jsxs)("div",{className:`p-4 rounded-lg font-semibold flex items-center gap-2 ${"success"===C.type?"bg-green-100 text-green-700 border border-green-300":"bg-red-100 text-red-700 border border-red-300"}`,children:["success"===C.type?r.jsx(l.Z,{size:20}):r.jsx(i.Z,{size:20}),C.text]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Bokningar"}),(0,r.jsxs)("p",{className:"text-gray-500 mt-1",children:[f.length," bokningar",$>0&&(0,r.jsxs)("span",{className:"ml-3 px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-semibold",children:[$," v\xe4ntar p\xe5 granskning"]}),z>0&&(0,r.jsxs)("span",{className:"ml-3 px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-semibold",children:[z," redo f\xf6r bekr\xe4ftelse"]})]})]}),(0,r.jsxs)("button",{onClick:()=>e.push("/dashboard/bookings/new"),className:"flex items-center gap-2 bg-gradient-to-r from-red-600 to-orange-600 text-white px-6 py-3 rounded-lg hover:shadow-lg transition-all font-semibold",children:[r.jsx(d.Z,{size:20}),"Ny Bokning"]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 border border-gray-200 space-y-4",children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx(c.Z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),r.jsx("input",{type:"text",placeholder:"S\xf6k efter bokningsnummer, kund eller plats...",value:v,onChange:e=>j(e.target.value),className:"w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:bg-white focus:border-red-500"})]}),r.jsx("div",{className:"flex gap-2 flex-wrap",children:P.map(e=>r.jsx("button",{onClick:()=>w(e.value),className:`px-4 py-2 rounded-lg font-medium transition-all ${N===e.value?"bg-gradient-to-r from-red-600 to-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:e.label},e.value))})]}),y?r.jsx("div",{className:"p-12 text-center text-gray-500",children:"Laddar bokningar..."}):0===f.length?r.jsx("div",{className:"p-12 text-center text-gray-500",children:"Inga bokningar hittades"}):r.jsx("div",{className:"space-y-3",children:f.map(t=>r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-all",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center",children:[(0,r.jsxs)("div",{className:"md:col-span-3 cursor-pointer",onClick:()=>e.push(`/dashboard/bookings/${t.id}`),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("p",{className:"font-bold text-gray-900 hover:text-blue-600",children:t.booking_number}),t.contract_signed&&r.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded font-semibold",children:"✅ Signerat"})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.customer.name})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Event"}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-700",children:[r.jsx(u.Z,{size:14}),(0,x.WU)(new Date(t.event_date),"d MMM",{locale:p.sv})]})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Plats"}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-700",children:[r.jsx(g.Z,{size:14}),t.location]})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Belopp"}),(0,r.jsxs)("p",{className:"font-bold text-lg text-green-600",children:[t.total_amount.toLocaleString("sv-SE")," SEK"]})]}),r.jsx("div",{className:"md:col-span-1",children:r.jsx("span",{className:`inline-flex px-3 py-1 rounded-full text-xs font-bold border ${B(t.status)}`,children:O(t.status)})}),(0,r.jsxs)("div",{className:"md:col-span-2 flex gap-2",children:["draft"===t.status&&(0,r.jsxs)("button",{onClick:()=>e.push(`/dashboard/bookings/${t.id}`),className:"flex-1 flex items-center justify-center gap-1 px-2 py-2 bg-orange-100 text-orange-600 rounded hover:bg-orange-200 transition-colors font-semibold text-sm",children:[r.jsx(m.Z,{size:16}),r.jsx("span",{className:"hidden sm:inline",children:"Granska"})]}),"pending"===t.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>Z(t.id,"cancelled"),disabled:_===t.id,className:"flex-1 flex items-center justify-center gap-1 px-2 py-2 bg-red-100 text-red-600 rounded hover:bg-red-200 transition-colors font-semibold text-sm disabled:opacity-50",children:[r.jsx(i.Z,{size:16}),r.jsx("span",{className:"hidden sm:inline",children:"Avb\xf6j"})]}),(0,r.jsxs)("button",{onClick:()=>q(t.id),disabled:_===t.id,className:"flex-1 flex items-center justify-center gap-1 px-2 py-2 bg-green-100 text-green-600 rounded hover:bg-green-200 transition-colors font-semibold text-sm disabled:opacity-50",children:[r.jsx(l.Z,{size:16}),r.jsx("span",{className:"hidden sm:inline",children:"Bekr\xe4fta"})]})]}),("confirmed"===t.status||"completed"===t.status)&&(0,r.jsxs)("button",{onClick:()=>e.push(`/dashboard/bookings/${t.id}`),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors font-semibold text-sm",children:[r.jsx(m.Z,{size:16}),r.jsx("span",{className:"hidden sm:inline",children:"Visa"})]})]})]})},t.id))})]})}},80508:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},73229:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},77373:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>o});let r=(0,s(86843).createProxy)(String.raw`/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/bookings/page.tsx`),{__esModule:a,$$typeof:n}=r,o=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,356,880,934,184,421],()=>s(34256));module.exports=r})();