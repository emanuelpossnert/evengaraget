(()=>{var e={};e.id=626,e.ids=[626],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29494:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>g,pages:()=>c,routeModule:()=>m,tree:()=>o});var r=s(50482),a=s(69108),n=s(62563),i=s.n(n),l=s(68300),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let o=["",{children:["dashboard",{children:["warehouse",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,18215)),"/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/warehouse/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,96339)),"/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,82917)),"/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/warehouse/page.tsx"],g="/dashboard/warehouse/page",x={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/warehouse/page",pathname:"/dashboard/warehouse",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},59384:(e,t,s)=>{Promise.resolve().then(s.bind(s,75553))},75553:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(95344),a=s(3729),n=s(27984),i=s(63024),l=s(64290),d=s(66138),o=s(14513),c=s(80508),g=s(55794);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,s(69224).Z)("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);var m=s(20016),u=s(8428);let p={low:"bg-blue-100 text-blue-700",medium:"bg-yellow-100 text-yellow-700",high:"bg-orange-100 text-orange-700",urgent:"bg-red-100 text-red-700"},b={pending:"bg-gray-100 text-gray-700",in_progress:"bg-blue-100 text-blue-700",completed:"bg-green-100 text-green-700"};function h(){let e=(0,u.useRouter)(),[t,s]=(0,a.useState)([]),[h,y]=(0,a.useState)(new Map),[f,j]=(0,a.useState)(new Map),[v,_]=(0,a.useState)(null),[N,w]=(0,a.useState)(!0),[k,D]=(0,a.useState)(null),[C,q]=(0,a.useState)(""),[E,S]=(0,a.useState)(""),[P,M]=(0,a.useState)(""),[Z,A]=(0,a.useState)(new Map);(0,a.useEffect)(()=>{z()},[]);let z=async()=>{try{w(!0);let{data:{user:e}}=await n.O.auth.getUser();if(!e){D({type:"error",text:"Inte inloggad"});return}q(e.id);let{data:t,error:r}=await n.O.from("booking_tasks").select("id, booking_id, title, description, priority, status, due_date, assigned_to_user_id").eq("assigned_to_user_id",e.id).neq("status","completed").order("due_date",{ascending:!0});if(r)throw r;if(t&&t.length>0){let e=[...new Set(t.map(e=>e.booking_id))],{data:r}=await n.O.from("bookings").select("id, booking_number, location, event_date, products_requested, customer_id, delivery_type").in("id",e),a=r?.map(e=>e.customer_id).filter(Boolean)||[],{data:i}=await n.O.from("customers").select("id, name").in("id",a),l=new Map(i?.map(e=>[e.id,e.name])||[]),d=new Map(r?.map(e=>[e.id,e])||[]),o=t.map(e=>{let t=d.get(e.booking_id);return{...e,booking_number:t?.booking_number||"N/A",location:t?.location||"N/A",event_date:t?.event_date||"N/A",customer_name:l.get(t?.customer_id)||"Ok\xe4nd kund",delivery_type:t?.delivery_type}});s(o),A(d);let c=new Map;for(let t of e){let{data:e}=await n.O.from("booking_wrapping_images").select("id, file_name, image_url").eq("booking_id",t);e&&c.set(t,e)}y(c);let{data:g}=await n.O.from("booking_notes").select("*").in("booking_id",e).order("created_at",{ascending:!1});if(g){let e=new Map;g.forEach(t=>{e.has(t.booking_id)||e.set(t.booking_id,[]),e.get(t.booking_id).push(t)}),j(e)}}}catch(e){console.error("Error fetching data:",e),D({type:"error",text:"Kunde inte ladda data"})}finally{w(!1)}},O=async(e,t)=>{try{let{error:r}=await n.O.from("booking_tasks").update({status:t}).eq("id",e);if(r)throw r;s(s=>s.map(s=>s.id===e?{...s,status:t}:s)),D({type:"success",text:"Status uppdaterad!"}),setTimeout(()=>D(null),2e3)}catch(e){console.error("Error updating status:",e),D({type:"error",text:"Kunde inte uppdatera status"})}},U=t.filter(e=>{let t=new Date(e.event_date);if(E&&t<new Date(E))return!1;if(P){let e=new Date(P);if(e.setHours(23,59,59,999),t>e)return!1}return!0}),$=()=>new Date().toISOString().split("T")[0];return N?r.jsx("div",{className:"flex items-center justify-center h-screen",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r.jsx("div",{className:"p-8 bg-gray-50 min-h-screen",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[r.jsx("div",{className:"flex items-center justify-between mb-8",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:()=>e.back(),className:"p-2 hover:bg-gray-200 rounded-lg transition",children:r.jsx(i.Z,{size:24,className:"text-gray-600"})}),(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"\uD83D\uDCE6 Mina K\xf6rningar"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Uppgifter tilldelade till dig"})]})]})}),k&&(0,r.jsxs)("div",{className:`mb-6 p-4 rounded-lg font-semibold flex items-center gap-2 ${"success"===k.type?"bg-green-100 text-green-700 border border-green-300":"bg-red-100 text-red-700 border border-red-300"}`,children:["success"===k.type?r.jsx(l.Z,{size:20}):r.jsx(d.Z,{size:20}),k.text]}),r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-8",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Fr\xe5n Datum"}),r.jsx("input",{type:"date",value:E,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Till Datum"}),r.jsx("input",{type:"date",value:P,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsx("button",{onClick:()=>{let e=$();S(e),M(e)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold transition",children:"\uD83D\uDCC5 Idag"}),(E||P)&&(0,r.jsxs)("button",{onClick:()=>{S(""),M("")},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-semibold flex items-center gap-2 transition",children:[r.jsx(o.Z,{size:18}),"Rensa Filter"]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[r.jsx("p",{className:"text-sm text-gray-600 font-semibold",children:"Mina Uppgifter"}),r.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:U.length}),(E||P)&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[t.length," totalt"]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[r.jsx("p",{className:"text-sm text-gray-600 font-semibold",children:"Br\xe5dskande"}),r.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:U.filter(e=>"urgent"===e.priority).length})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[r.jsx("p",{className:"text-sm text-gray-600 font-semibold",children:"P\xe5g\xe5ende"}),r.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:U.filter(e=>"in_progress"===e.status).length})]})]}),r.jsx("div",{className:"space-y-4",children:0===U.length?(0,r.jsxs)("div",{className:"bg-white rounded-lg p-8 text-center border border-gray-200",children:[r.jsx(l.Z,{size:48,className:"mx-auto text-green-300 mb-4"}),r.jsx("p",{className:"text-gray-500 font-semibold",children:0===t.length?"Inga uppgifter tilldelade":"Inga uppgifter f\xf6r valda datum"})]}):U.map(e=>(0,r.jsxs)("div",{className:`bg-white rounded-lg border-2 p-4 transition ${"urgent"===e.priority?"border-red-300":"border-gray-200"}`,children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-bold text-lg text-gray-900",children:e.title}),(0,r.jsxs)("div",{className:"flex gap-3 mt-1 text-sm text-gray-600",children:[(0,r.jsxs)("span",{children:["\uD83D\uDCCC ",e.booking_number]}),(0,r.jsxs)("span",{children:["\uD83D\uDC64 ",e.customer_name]})]})]}),r.jsx("span",{className:`px-3 py-1 rounded text-xs font-bold ${p[e.priority]}`,children:e.priority.toUpperCase()})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(c.Z,{size:16}),e.location]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(g.Z,{size:16}),new Date(e.event_date).toLocaleDateString("sv-SE")]}),r.jsx("div",{children:(0,r.jsxs)("a",{href:`https://www.google.com/maps/search/${encodeURIComponent(e.location)}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 font-semibold",children:[r.jsx(x,{size:16}),"Google Maps"]})})]}),e.delivery_type&&r.jsx("div",{className:"mb-4",children:r.jsx("span",{className:`inline-block px-3 py-1 rounded text-xs font-semibold ${"internal"===e.delivery_type?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:"internal"===e.delivery_type?"\uD83C\uDFE2 Intern leverans":"\uD83D\uDE9A Extern leverans"})}),(0,r.jsxs)("button",{onClick:()=>_(v===e.id?null:e.id),className:"w-full mb-4 p-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-semibold transition text-left",children:[v===e.id?"▼":"▶"," Detaljer & Bilder"]}),v===e.id&&(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-4 space-y-3",children:[e.description&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Beskrivning:"}),r.jsx("p",{className:"text-sm text-gray-700",children:e.description})]}),Z.get(e.booking_id)?.products_requested&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"\uD83D\uDCE6 Produkter i Leveransen:"}),r.jsx("div",{className:"bg-white rounded p-3 border border-gray-200",children:(()=>{let t=[],s=Z.get(e.booking_id)?.products_requested;try{"string"==typeof s?t=JSON.parse(s):Array.isArray(s)&&(t=s)}catch(e){console.error("Error parsing products:",e)}return r.jsx("ul",{className:"space-y-1",children:t.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 flex items-start gap-2",children:[r.jsx("span",{className:"text-gray-400",children:"•"}),(0,r.jsxs)("span",{children:[r.jsx("strong",{children:e.name}),e.quantity&&(0,r.jsxs)("span",{className:"text-gray-600",children:[" (x",e.quantity,")"]}),e.wrapping_requested&&r.jsx("span",{className:"ml-2 text-blue-600 text-xs bg-blue-50 px-2 py-1 rounded",children:"\uD83C\uDFA8 Foliering"})]})]},t))})})()})]}),f.get(e.booking_id)&&f.get(e.booking_id).length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:["\uD83D\uDCDD Anteckningar (",f.get(e.booking_id).length,")"]}),r.jsx("div",{className:"space-y-2",children:f.get(e.booking_id).map(e=>(0,r.jsxs)("div",{className:"bg-white p-3 rounded border border-gray-200",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[r.jsx("p",{className:"text-xs font-semibold text-gray-600",children:e.created_by_name}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:[new Date(e.created_at).toLocaleDateString("sv-SE")," kl ",new Date(e.created_at).toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"})]})]}),r.jsx("p",{className:"text-xs text-gray-700 whitespace-pre-wrap",children:e.note})]},e.id))})]}),h.get(e.booking_id)&&h.get(e.booking_id).length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-xs font-semibold text-gray-600 mb-2 flex items-center gap-1",children:[r.jsx(m.Z,{size:14})," Foliering Bilder (",h.get(e.booking_id).length,")"]}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:h.get(e.booking_id).map(e=>(0,r.jsxs)("a",{href:e.image_url,target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden rounded-lg border border-gray-300 hover:border-blue-500 transition",children:[r.jsx("img",{src:e.image_url,alt:e.file_name,className:"w-full h-24 object-cover hover:scale-110 transition"}),r.jsx("p",{className:"text-xs text-gray-600 p-1 bg-white truncate",children:e.file_name})]},e.id))})]})]}),r.jsx("div",{className:"flex gap-2 flex-wrap",children:["pending","in_progress","completed"].map(t=>(0,r.jsxs)("button",{onClick:()=>O(e.id,t),className:`px-4 py-2 rounded text-sm font-semibold transition ${e.status===t?"ring-2 ring-offset-2 ring-blue-600 "+b[t]:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["pending"===t&&"⏳ V\xe4ntande","in_progress"===t&&"⚡ P\xe5g\xe5ande","completed"===t&&"✅ Slutf\xf6rd"]},t))})]},e.id))})]})})}},66138:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},64290:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},14513:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},18215:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,s(86843).createProxy)(String.raw`/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/warehouse/page.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,356,880,934,142],()=>s(29494));module.exports=r})();