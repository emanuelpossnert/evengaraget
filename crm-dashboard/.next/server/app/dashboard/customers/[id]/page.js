(()=>{var e={};e.id=541,e.ids=[541],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},49387:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>c,routeModule:()=>m,tree:()=>o});var a=s(50482),r=s(69108),l=s(62563),n=s.n(l),i=s(68300),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let o=["",{children:["dashboard",{children:["customers",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,48771)),"/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/customers/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,96339)),"/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,82917)),"/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/customers/[id]/page.tsx"],x="/dashboard/customers/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/customers/[id]/page",pathname:"/dashboard/customers/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},28065:(e,t,s)=>{Promise.resolve().then(s.bind(s,93383))},93383:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(95344),r=s(3729),l=s(27984),n=s(8428),i=s(63024),d=s(66138),o=s(38271),c=s(38852),x=s(71206),u=s(51838),m=s(37121),g=s(39674),p=s(48067),h=s(42719);function b(){let e=(0,n.useRouter)(),t=(0,n.useParams)().id,[s,b]=(0,r.useState)(null),[y,j]=(0,r.useState)([]),[v,f]=(0,r.useState)([]),[N,D]=(0,r.useState)([]),[k,_]=(0,r.useState)([]),[w,S]=(0,r.useState)([]),[C,E]=(0,r.useState)([]),[M,P]=(0,r.useState)(!0),[F,U]=(0,r.useState)(!1),[A,O]=(0,r.useState)("overview"),[q,$]=(0,r.useState)(null),[T,K]=(0,r.useState)(""),[B,H]=(0,r.useState)({title:"",description:"",task_type:"call",due_date:"",priority:"normal"}),[I,L]=(0,r.useState)({call_date:"",duration:0,call_type:"outbound",topic:"",outcome:"neutral",notes:""}),[Z,z]=(0,r.useState)({subject:"",body:""}),[W,R]=(0,r.useState)(!1),[V,G]=(0,r.useState)(""),[X,J]=(0,r.useState)(!1),[Q,Y]=(0,r.useState)(""),[ee,et]=(0,r.useState)(!1),[es,ea]=(0,r.useState)({});(0,r.useEffect)(()=>{er()},[t]);let er=async()=>{try{P(!0);let{data:e}=await l.O.from("customers").select("*").eq("id",t).single();e&&(b(e),ea(e));let{data:s}=await l.O.from("bookings").select("*").eq("customer_id",t).order("created_at",{ascending:!1});s&&j(s);let{data:a}=await l.O.from("customer_notes").select("*").eq("customer_id",t).order("created_at",{ascending:!1});a&&f(a);let{data:r}=await l.O.from("customer_tasks").select("*").eq("customer_id",t).order("due_date",{ascending:!0});r&&D(r);let{data:n}=await l.O.from("conversations").select("id").eq("customer_id",t);if(n&&n.length>0){let e=n.map(e=>e.id),{data:t}=await l.O.from("messages").select("id, subject, body_plain, direction, created_at").in("conversation_id",e).order("created_at",{ascending:!1});t&&_(t)}if(s&&s.length>0){let e=s.map(e=>e.id),{data:t}=await l.O.from("booking_comments").select("id, booking_id, sender_type, sender_name, message, created_at").in("booking_id",e).order("created_at",{ascending:!1});if(t){let e=t.map(e=>({...e,booking_number:s.find(t=>t.id===e.booking_id)?.booking_number}));S(e)}}}catch(e){console.error("Error fetching data:",e),$({type:"error",text:"Kunde inte ladda kunddata"})}finally{P(!1)}},el=async()=>{try{let{data:e,error:s}=await l.O.from("invoices").select("*").eq("customer_id",t).order("invoice_date",{ascending:!1});if(s)throw s;E(e||[])}catch(e){console.error("Error fetching invoices:",e)}};(0,r.useEffect)(()=>{0===C.length&&"invoices"===A&&el()},[A]);let en=async()=>{if(T.trim())try{let{error:e}=await l.O.from("customer_notes").insert([{customer_id:t,content:T,created_by:(await l.O.auth.getUser()).data.user?.id}]);if(e)throw e;K(""),er(),$({type:"success",text:"Anteckning tillagd!"}),setTimeout(()=>$(null),2e3)}catch(e){console.error("Error adding note:",e),$({type:"error",text:"Kunde inte l\xe4gga till anteckning"})}},ei=async()=>{if(B.title.trim())try{let{error:e}=await l.O.from("customer_tasks").insert([{customer_id:t,...B,created_by:(await l.O.auth.getUser()).data.user?.id}]);if(e)throw e;H({title:"",description:"",task_type:"call",due_date:"",priority:"normal"}),er(),$({type:"success",text:"Uppgift skapad!"}),setTimeout(()=>$(null),2e3)}catch(e){console.error("Error adding task:",e),$({type:"error",text:"Kunde inte skapa uppgift"})}},ed=async e=>{try{let{error:t}=await l.O.from("customer_tasks").delete().eq("id",e);if(t)throw t;er()}catch(e){console.error("Error deleting task:",e)}},eo=async(e,t)=>{try{let s="completed"===t?"pending":"completed",{error:a}=await l.O.from("customer_tasks").update({status:s,completed_at:"completed"===s?new Date().toISOString():null}).eq("id",e);if(a)throw a;er()}catch(e){console.error("Error toggling task:",e)}},ec=async()=>{try{let{error:e}=await l.O.from("customers").update({priority:es.priority,next_action_date:es.next_action_date,next_action_description:es.next_action_description}).eq("id",t);if(e)throw e;et(!1),er(),$({type:"success",text:"Kund uppdaterad!"}),setTimeout(()=>$(null),2e3)}catch(e){console.error("Error updating customer:",e),$({type:"error",text:"Kunde inte uppdatera kund"})}},ex=async()=>{if(!Z.subject.trim()||!Z.body.trim()){$({type:"error",text:"\xc4mne och meddelande kr\xe4vs"}),setTimeout(()=>$(null),2e3);return}R(!0);try{let{error:e}=await l.O.from("outgoing_emails").insert([{customer_id:t,recipient_email:s?.email,subject:Z.subject,body_plain:Z.body,body_html:Z.body,email_type:"custom_message",status:"pending"}]);if(e)throw e;await l.O.from("messages").insert([{customer_id:t,subject:Z.subject,body_plain:Z.body,direction:"outbound",created_at:new Date().toISOString()}]),z({subject:"",body:""}),er(),$({type:"success",text:"✅ E-post sparad! Skickas via n8n..."}),setTimeout(()=>$(null),3e3)}catch(e){console.error("Error sending email:",e),$({type:"error",text:"Kunde inte skicka e-post"}),setTimeout(()=>$(null),2e3)}finally{R(!1)}},eu=async()=>{if(!V.trim()||!Q){$({type:"error",text:"V\xe4lj en bokning och skriv ett meddelande"}),setTimeout(()=>$(null),2e3);return}try{J(!0);let{error:e}=await l.O.from("booking_comments").insert([{booking_id:Q,sender_type:"admin",sender_name:"EventGaraget Admin",message:V.trim()}]);if(e)throw e;G(""),Y(""),$({type:"success",text:"✅ Svar skickat!"}),setTimeout(()=>$(null),2e3),er()}catch(e){console.error("Error sending comment:",e),$({type:"error",text:"Kunde inte skicka meddelandet"}),setTimeout(()=>$(null),3e3)}finally{J(!1)}};if(M)return a.jsx("div",{className:"flex items-center justify-center h-screen",children:"Laddar kunddata..."});if(!s)return a.jsx("div",{className:"flex items-center justify-center h-screen text-red-600",children:"Kund inte hittad"});let em=N.filter(e=>"pending"===e.status).length;return N.filter(e=>"pending"===e.status&&e.due_date&&new Date(e.due_date)>new Date).length,(0,a.jsxs)("div",{className:"space-y-6 pb-12",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:()=>e.push("/dashboard/customers"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(i.Z,{size:24,className:"text-gray-600"})}),(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s.name}),a.jsx("p",{className:"text-gray-500 mt-1",children:s.company_name||"Privatperson"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:["urgent"===s.priority&&a.jsx("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-bold",children:"\uD83D\uDEA8 BR\xc5DSKANDE"}),"high"===s.priority&&a.jsx("span",{className:"px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-bold",children:"⬆️ H\xd6G PRIORITET"}),em>0&&(0,a.jsxs)("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-bold",children:[em," Uppgifter"]})]})]}),q&&a.jsx("div",{className:`p-4 rounded-lg ${"success"===q.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:q.text}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[a.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Totala Bokningar"}),a.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:s.total_bookings||0})]}),(0,a.jsxs)("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[a.jsx("p",{className:"text-xs text-green-600 font-medium",children:"Total Int\xe4kt"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-900 mt-1",children:[(s.total_revenue||0).toLocaleString("sv-SE")," SEK"]})]}),(0,a.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[a.jsx("p",{className:"text-xs text-purple-600 font-medium",children:"Livstidsv\xe4rde"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[(s.lifetime_value||0).toLocaleString("sv-SE")," SEK"]})]}),(0,a.jsxs)("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:[a.jsx("p",{className:"text-xs text-orange-600 font-medium",children:"Status"}),a.jsx("p",{className:"text-lg font-bold text-orange-900 mt-1 capitalize",children:s.status})]})]}),s.next_action_date&&(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex gap-3",children:[a.jsx(d.Z,{className:"text-yellow-600 flex-shrink-0",size:20}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-semibold text-yellow-900",children:"N\xe4sta \xe5tg\xe4rd"}),a.jsx("p",{className:"text-sm text-yellow-800",children:s.next_action_description}),a.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:(0,g.WU)(new Date(s.next_action_date),"d MMMM yyyy",{locale:p.sv})})]})]}),a.jsx("div",{className:"flex gap-2 bg-white rounded-lg p-2 border border-gray-200 overflow-x-auto",children:[{id:"overview",label:"\xd6versikt",icon:"\uD83D\uDCCA"},{id:"notes",label:`Anteckningar (${v.length})`,icon:"\uD83D\uDCDD"},{id:"tasks",label:`Uppgifter (${em})`,icon:"✓"},{id:"booking-messages",label:`Meddelanden (${w.length})`,icon:"\uD83D\uDCAC"},{id:"messages",label:`E-post (${k.length})`,icon:"\uD83D\uDCE7"},{id:"bookings",label:`Bokningar (${y.length})`,icon:"\uD83D\uDCE6"},{id:"invoices",label:`Fakturor (${C.length})`,icon:"\uD83D\uDCCB"}].map(e=>(0,a.jsxs)("button",{onClick:()=>O(e.id),className:`px-4 py-2 rounded-lg font-medium transition-all whitespace-nowrap ${A===e.id?"bg-gradient-to-r from-red-600 to-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.icon," ",e.label]},e.id))}),"overview"===A&&(0,a.jsxs)("div",{className:"space-y-6",children:[s.is_vip&&s.total_revenue&&s.total_revenue>5e4&&a.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-lg p-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-4xl",children:"\uD83D\uDC51"}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-yellow-900",children:"VIP Kund"}),(0,a.jsxs)("p",{className:"text-sm text-yellow-700",children:["Total int\xe4kt: ",(0,a.jsxs)("span",{className:"font-bold",children:[(s.total_revenue||0).toLocaleString("sv-SE")," SEK"]})]})]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83D\uDCCB Kontaktinformation"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Email"}),a.jsx("p",{className:"text-gray-900 font-medium mt-1",children:s.email})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Telefon"}),a.jsx("p",{className:"text-gray-900 font-medium mt-1",children:s.phone||"-"})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"F\xf6retag"}),a.jsx("p",{className:"text-gray-900 font-medium mt-1",children:s.company_name||"-"})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Org-nummer"}),a.jsx("p",{className:"text-gray-900 font-medium mt-1",children:s.org_number||"-"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Adress"}),(0,a.jsxs)("p",{className:"text-gray-900 font-medium mt-1",children:[s.street_address,", ",s.postal_code," ",s.city,", ",s.country]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Kundtyp"}),(0,a.jsxs)("p",{className:"text-gray-900 font-medium mt-1",children:["business"===s.customer_type?"F\xf6retag":"Privat",s.is_vip&&" (VIP)"]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Status"}),a.jsx("p",{className:"text-gray-900 font-medium mt-1",children:"active"===s.status?"\uD83D\uDFE2 Aktiv":"inactive"===s.status?"\uD83D\uDFE1 Inaktiv":"\uD83D\uDD34 Blockerad"})]})]}),s.notes&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Anteckningar"}),a.jsx("p",{className:"text-gray-900 mt-1 whitespace-pre-wrap",children:s.notes})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"⚡ Prioritet & N\xe4sta \xc5tg\xe4rd"}),a.jsx("button",{onClick:()=>et(!ee),className:"px-3 py-1 bg-blue-50 text-blue-600 rounded text-sm font-semibold hover:bg-blue-100",children:ee?"Avbryt":"Redigera"})]}),ee?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Prioritet"}),(0,a.jsxs)("select",{value:es.priority||"normal",onChange:e=>ea({...es,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm",children:[a.jsx("option",{value:"low",children:"\uD83D\uDFE2 L\xe5g"}),a.jsx("option",{value:"normal",children:"\uD83D\uDFE1 Normal"}),a.jsx("option",{value:"high",children:"\uD83D\uDFE0 H\xf6g"}),a.jsx("option",{value:"urgent",children:"\uD83D\uDD34 Br\xe5dskande"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"N\xe4sta \xe5tg\xe4rd"}),a.jsx("input",{type:"text",value:es.next_action_description||"",onChange:e=>ea({...es,next_action_description:e.target.value}),placeholder:"Ex: Ring f\xf6r att f\xf6lja upp",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Datum f\xf6r n\xe4sta \xe5tg\xe4rd"}),a.jsx("input",{type:"date",value:es.next_action_date?.split("T")[0]||"",onChange:e=>ea({...es,next_action_date:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),a.jsx("button",{onClick:ec,className:"w-full px-3 py-2 bg-green-600 text-white rounded font-semibold hover:bg-green-700",children:"Spara"})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{children:[a.jsx("span",{className:"text-gray-600",children:"Prioritet:"})," ",a.jsx("span",{className:"font-semibold",children:"urgent"===s.priority?"\uD83D\uDD34 Br\xe5dskande":"high"===s.priority?"\uD83D\uDFE0 H\xf6g":"low"===s.priority?"\uD83D\uDFE2 L\xe5g":"\uD83D\uDFE1 Normal"})]}),s.next_action_description&&a.jsx("p",{className:"text-gray-700",children:s.next_action_description}),s.next_action_date&&a.jsx("p",{className:"text-sm text-gray-600",children:(0,g.WU)(new Date(s.next_action_date),"d MMMM yyyy",{locale:p.sv})})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83D\uDD50 Senaste Aktivitet"}),a.jsx("div",{className:"space-y-3",children:v.slice(0,3).map(e=>(0,a.jsxs)("div",{className:"p-3 bg-gray-50 rounded border border-gray-200",children:[a.jsx("p",{className:"text-sm text-gray-700",children:e.content}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(0,g.WU)(new Date(e.created_at),"d MMM yyyy HH:mm",{locale:p.sv})})]},e.id))})]})]}),"notes"===A&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83D\uDCDD L\xe4gg till Anteckning"}),a.jsx("textarea",{value:T,onChange:e=>K(e.target.value),placeholder:"Skriv en anteckning om kunden...",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm h-24"}),a.jsx("button",{onClick:en,className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded font-semibold hover:bg-blue-700",children:"Spara Anteckning"})]}),a.jsx("div",{className:"space-y-3",children:v.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[a.jsx("p",{className:"text-gray-900",children:e.content}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:(0,g.WU)(new Date(e.created_at),"d MMM yyyy HH:mm",{locale:p.sv})})]},e.id))})]}),"tasks"===A&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"✓ Ny Uppgift"}),(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("input",{type:"text",value:B.title,onChange:e=>H({...B,title:e.target.value}),placeholder:"Titel p\xe5 uppgift",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"}),a.jsx("textarea",{value:B.description,onChange:e=>H({...B,description:e.target.value}),placeholder:"Beskrivning (valfritt)",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm h-16"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("select",{value:B.task_type,onChange:e=>H({...B,task_type:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[a.jsx("option",{value:"call",children:"☎️ Samtal"}),a.jsx("option",{value:"email",children:"\uD83D\uDCE7 Email"}),a.jsx("option",{value:"meeting",children:"\uD83D\uDCC5 M\xf6te"}),a.jsx("option",{value:"follow-up",children:"\uD83D\uDD04 F\xf6lj upp"}),a.jsx("option",{value:"other",children:"\uD83D\uDCCC \xd6vrigt"})]}),(0,a.jsxs)("select",{value:B.priority,onChange:e=>H({...B,priority:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[a.jsx("option",{value:"low",children:"\uD83D\uDFE2 L\xe5g"}),a.jsx("option",{value:"normal",children:"\uD83D\uDFE1 Normal"}),a.jsx("option",{value:"high",children:"\uD83D\uDFE0 H\xf6g"}),a.jsx("option",{value:"urgent",children:"\uD83D\uDD34 Br\xe5dskande"})]})]}),a.jsx("input",{type:"date",value:B.due_date,onChange:e=>H({...B,due_date:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"}),a.jsx("button",{onClick:ei,className:"w-full px-4 py-2 bg-blue-600 text-white rounded font-semibold hover:bg-blue-700",children:"Skapa Uppgift"})]})]}),a.jsx("div",{className:"space-y-3",children:N.map(e=>a.jsx("div",{className:`bg-white rounded-lg border border-gray-200 p-4 ${"completed"===e.status?"opacity-60":""}`,children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:"completed"===e.status,onChange:()=>eo(e.id,e.status),className:"w-5 h-5 cursor-pointer"}),a.jsx("span",{className:`font-semibold ${"completed"===e.status?"line-through text-gray-500":"text-gray-900"}`,children:e.title}),a.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${"urgent"===e.priority?"bg-red-100 text-red-700":"high"===e.priority?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-700"}`,children:e.priority})]}),e.description&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:e.due_date?`F\xf6rfallet: ${(0,g.WU)(new Date(e.due_date),"d MMM yyyy",{locale:p.sv})}`:"Ingen deadline"})]}),a.jsx("button",{onClick:()=>ed(e.id),className:"text-gray-400 hover:text-red-600",children:a.jsx(o.Z,{size:18})})]})},e.id))})]}),"booking-messages"===A&&(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83D\uDCAC Bokningsmeddelanden"}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg border-2 border-blue-300 p-6",children:[a.jsx("h3",{className:"text-lg font-bold text-blue-900 mb-4 flex items-center gap-2",children:"✍️ Snabbt Svar"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-blue-900 mb-2",children:"\uD83D\uDCCC V\xe4lj Bokning att Svara P\xe5"}),(0,a.jsxs)("select",{value:Q,onChange:e=>Y(e.target.value),className:"w-full px-4 py-3 border-2 border-blue-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white font-semibold text-gray-900",children:[a.jsx("option",{value:"",children:"-- V\xe4lj en bokning --"}),w.length>0&&a.jsx("optgroup",{label:"Bokningar med meddelanden",children:Array.from(new Map(w.map(e=>[e.booking_id,e])).values()).map(e=>a.jsx("option",{value:e.booking_id,children:e.booking_number},e.booking_id))})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-blue-900 mb-2",children:"\uD83D\uDCAC Ditt Svar"}),a.jsx("textarea",{value:V,onChange:e=>G(e.target.value),placeholder:"Skriv ditt svar h\xe4r...",className:"w-full px-4 py-3 border-2 border-blue-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent h-20 resize-none",maxLength:500}),a.jsx("div",{className:"flex justify-between items-center mt-2",children:(0,a.jsxs)("span",{className:"text-xs text-blue-700 font-semibold",children:[V.length,"/500"]})})]}),a.jsx("button",{onClick:eu,disabled:X||!V.trim()||!Q,className:"w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition font-bold text-lg flex items-center justify-center gap-2",children:X?(0,a.jsxs)(a.Fragment,{children:[a.jsx("span",{className:"animate-spin",children:"⏳"}),"Skickar..."]}):a.jsx(a.Fragment,{children:"✉️ Skicka Svar"})})]})]}),a.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Meddelanden"}),a.jsx("div",{className:"space-y-3",children:0===w.length?(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[a.jsx(c.Z,{size:32,className:"mx-auto text-gray-400 mb-2"}),a.jsx("p",{className:"text-gray-500",children:"Inga bokningsmeddelanden \xe4n"})]}):w.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[a.jsx("div",{className:"flex justify-between items-start mb-2",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("span",{className:"font-semibold text-gray-900",children:e.sender_name||"Kund"}),a.jsx("span",{className:`inline-flex items-center justify-center px-2 py-1 rounded text-xs font-bold ${"customer"===e.sender_type?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:"customer"===e.sender_type?"\uD83D\uDD35 Kund":"\uD83D\uDFE2 Admin"}),(0,a.jsxs)("a",{href:`/dashboard/bookings/${e.booking_id}`,className:"text-sm text-blue-600 hover:underline font-semibold",children:["\uD83D\uDCCC ",e.booking_number]})]}),a.jsx("p",{className:"text-sm text-gray-700",children:e.message})]})}),a.jsx("p",{className:"text-xs text-gray-600",children:(0,g.WU)(new Date(e.created_at),"d MMM yyyy HH:mm",{locale:p.sv})})]},e.id))})]}),"messages"===A&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83D\uDCE7 Skicka E-post"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Till"}),a.jsx("input",{type:"email",value:s?.email||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded text-sm bg-gray-50 text-gray-700"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"\xc4mne *"}),a.jsx("input",{type:"text",value:Z.subject,onChange:e=>z({...Z,subject:e.target.value}),placeholder:"Ex: F\xf6lj upp p\xe5 offert",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Meddelande *"}),a.jsx("textarea",{value:Z.body,onChange:e=>z({...Z,body:e.target.value}),placeholder:"Skriv ditt meddelande h\xe4r...",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm h-24"})]}),a.jsx("button",{onClick:ex,disabled:W,className:"w-full px-4 py-2 bg-blue-600 text-white rounded font-semibold hover:bg-blue-700 disabled:bg-gray-400",children:W?"Skickar...":"Skicka E-post"}),a.jsx("p",{className:"text-xs text-gray-500",children:"E-posten sparas i historiken och skickas via n8n-workflow"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83D\uDCE8 E-posthistorik"}),a.jsx("div",{className:"space-y-3",children:0===k.length?(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[a.jsx(x.Z,{size:32,className:"mx-auto text-gray-400 mb-2"}),a.jsx("p",{className:"text-gray-500",children:"Inga e-postmeddelanden \xe4n"})]}):k.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[a.jsx("div",{className:"flex justify-between items-start mb-2",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold ${"inbound"===e.direction?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:"inbound"===e.direction?"\uD83D\uDCE7":"\uD83D\uDCE4"}),a.jsx("p",{className:"font-semibold text-gray-900",children:e.subject})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["inbound"===e.direction?"Inkommande":"Utg\xe5ende"," •"," ",(0,g.WU)(new Date(e.created_at),"d MMM yyyy HH:mm",{locale:p.sv})]})]})}),a.jsx("p",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded mt-2 whitespace-pre-wrap",children:e.body_plain})]},e.id))})]})]}),"bookings"===A&&a.jsx("div",{className:"space-y-3",children:y.map(t=>(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold text-gray-900",children:t.booking_number}),a.jsx("p",{className:"text-sm text-gray-600",children:(0,g.WU)(new Date(t.event_date),"d MMM yyyy",{locale:p.sv})})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-bold text-green-600",children:[t.total_amount.toLocaleString("sv-SE")," SEK"]}),a.jsx("span",{className:`inline-block text-xs px-2 py-1 rounded mt-1 ${"confirmed"===t.status?"bg-green-100 text-green-700":"pending"===t.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:"confirmed"===t.status?"✅ Bekr\xe4ftad":"pending"===t.status?"⏳ V\xe4ntande":"Utkast"})]})]}),a.jsx("button",{onClick:()=>e.push(`/dashboard/bookings/${t.id}`),className:"mt-3 text-blue-600 hover:text-blue-700 text-sm font-semibold",children:"Se detaljer →"})]},t.id))}),"invoices"===A&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Fakturor f\xf6r denna kund"}),(0,a.jsxs)("button",{onClick:()=>U(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold transition",children:[a.jsx(u.Z,{size:18}),"Skapa Faktura"]})]}),F&&a.jsx(h._,{initialCustomerId:t,onClose:()=>U(!1),onSuccess:()=>{el(),$({type:"success",text:"Faktura skapad!"}),setTimeout(()=>$(null),3e3)}}),0===C.length?(0,a.jsxs)("div",{className:"bg-white rounded-lg p-8 text-center border border-gray-200",children:[a.jsx(m.Z,{size:48,className:"mx-auto text-gray-300 mb-4"}),a.jsx("p",{className:"text-gray-500 font-semibold",children:"Inga fakturor \xe4nnu"}),a.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Skapa en faktura f\xf6r denna kund"})]}):a.jsx("div",{className:"space-y-3",children:C.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold text-gray-900",children:e.invoice_number}),a.jsx("p",{className:"text-sm text-gray-600",children:(0,g.WU)(new Date(e.invoice_date),"d MMM yyyy",{locale:p.sv})})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-bold text-blue-600",children:[e.total_amount.toLocaleString("sv-SE")," SEK"]}),a.jsx("span",{className:`inline-block text-xs px-2 py-1 rounded mt-1 ${"paid"===e.status?"bg-green-100 text-green-700":"sent"===e.status?"bg-blue-100 text-blue-700":"draft"===e.status?"bg-gray-100 text-gray-700":"bg-orange-100 text-orange-700"}`,children:"paid"===e.status?"✅ Betald":"sent"===e.status?"\uD83D\uDCE7 Skickad":"draft"===e.status?"\uD83D\uDCDD Utkast":"⚠️ F\xf6rfallen"})]})]}),a.jsx("a",{href:`/dashboard/invoices/${e.id}`,className:"mt-3 text-blue-600 hover:text-blue-700 text-sm font-semibold",children:"Se detaljer →"})]},e.id))})]})]})}},63024:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(69224).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},71206:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(69224).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},38852:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(69224).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},48771:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>r,default:()=>n});let a=(0,s(86843).createProxy)(String.raw`/Users/emanuelpossnert/Documents/Dev projects/Eventgaraget/crm-dashboard/app/dashboard/customers/[id]/page.tsx`),{__esModule:r,$$typeof:l}=a,n=a.default}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[638,26,477,934,184,910,544],()=>s(49387));module.exports=a})();